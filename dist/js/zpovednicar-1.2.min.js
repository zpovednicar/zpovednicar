"use strict";for(let e of["CSS_TINGLE","CSS_TABBY","CSS_MODAL","CSS_PICKER","CSS_CUSTOM"]){GM_addStyle(GM_getResourceText(e))}const f=function(){let e=document.createElement("style");e.appendChild(document.createTextNode(""));document.head.appendChild(e);return e}();function e(e){if(document.readyState!=="loading"){e()}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",e)}else{document.attachEvent("onreadystatechange",function(){if(document.readyState=="complete")e()})}}e(function(){let r,s,l;const t={language:window.location.hostname.match(/^(www\.)?spovednica\.sk$/)?"sk":"cz",cz:{yes:"Ano",no:"Ne",ok:"Rozumím",menuLabel:"ZPOVĚDNIČÁŘ",enable:"zapnout",disable:"vypnout",comingSoon:"už brzy",domainsNone:"-- nepoužívat --",questionHighlightUser:"Opravdu smazat zvýrazněného uživatele?",questionHideUser:"Opravdu smazat skrývaného uživatele?",questionHighlightWord:"Opravdu smazat zvýrazněný výraz?",questionHideWord:"Opravdu smazat skrývaný výraz?",settingsSubmit:"Uložit",settingsSend:"Odeslat",settingsCancel:"Zrušit",settingsUser:"přezdívka",settingsWord:"výraz",settingsClose:"Zavřít",settingsHighlight:"Zvýrazňovat",settingsHide:"Skrývat",settingsLabel:"Nastavení",settingsUsers:"Přezdívky",settingsWords:"Výrazy",settingsNone:"žádné",settingsColor:"Barva zvýraznění",settingsDomain:"Vynutit doménu",settingsHideDeleted:"Skrývat smazané",settingsHideUnregistered:"Skrývat neregistrované",settingsTransformAnchors:"Odkazy otevřít ve stejném okně",settingsYoutubeThumbnails:"Náhledy Youtube videí",idiomContentLength:"Minimální délka jsou [length] znaky",idiomContentExists:"Záznam existuje ve [highlight], obojí najednou není možné",idiomContentHighlighted:"zvýrazňovaných",idiomContentHidden:"skrývaných",fileSaverUnsupported:"Nepodporováno vaším prohlížečem",settingsBackups:"Zálohování",settingsBackup:"Zálohovat",settingsBackupEmpty:"Databáze je prázdná, není co zálohovat",settingsBackupPassword:"Heslo pro soubor se zálohou",settingsBackupSuccess:"Záloha proběhla úspěšně, stahuje se soubor:<br><br>[filename]",settingsRestore:"Obnovit",settingsRestoreError:"Neplatné heslo nebo poškozený soubor se zálohou",settingsRestoreSuccess:"Obnova ze zálohy proběhla úspěšně",thumbnailsNone:"-- žádné --",helpLabel:"Nápovědu najdete na",hideUser:"Skrývat přezdívku",highlightUser:"Zvýrazňovat přezdívku"},sk:{yes:"Áno",no:"Nie",ok:"Rozumiem",menuLabel:"SPOVEDNIČIAR",enable:"zapnúť",disable:"vypnúť",comingSoon:"už čoskoro",domainsNone:"-- nepoužívať --",questionHighlightUser:"Naozaj zmazať zvýrazneného užívateľa?",questionHideUser:"Naozaj zmazať skrývaného užívateľa?",questionHighlightWord:"Naozaj zmazať zvýraznený výraz?",questionHideWord:"Naozaj zmazať skrývaný výraz?",settingsSubmit:"Uložiť",settingsSend:"Odoslať",settingsCancel:"Zrušiť",settingsUser:"prezývka",settingsWord:"výraz",settingsClose:"Zavrieť",settingsHighlight:"Zvýrazňovať",settingsHide:"Skrývať",settingsLabel:"Nastavenia",settingsUsers:"Prezývky",settingsWords:"Výrazy",settingsNone:"žiadne",settingsColor:"Farba zvýraznenia",settingsDomain:"Vynútiť doménu",settingsHideDeleted:"Skrývať zmazané",settingsHideUnregistered:"Skrývať neregistrované",settingsTransformAnchors:"Odkazy otvoriť v rovnakom okne",settingsYoutubeThumbnails:"Náhľady Youtube videí",idiomContentLength:"Minimálna dĺžka sú [length] znaky",idiomContentExists:"Záznam existuje vo [highlight], oboje naraz nie je možné",idiomContentHighlighted:"zvýrazňovaných",idiomContentHidden:"skrývaných",fileSaverUnsupported:"Nepodporované vašim prehliadačom",settingsBackups:"Zálohovanie",settingsBackup:"Zálohovať",settingsBackupEmpty:"Databáza je prázdna, nie je čo zálohovať",settingsBackupPassword:"Heslo pre súbor so zálohou",settingsBackupSuccess:"Záloha prebehla úspešne, sťahuje sa súbor:<br><br>[filename]",settingsRestore:"Obnoviť",settingsRestoreError:"Neplatné heslo alebo poškodený súbor so zálohou",settingsRestoreSuccess:"Obnova zo zálohy prebehla úspešne",thumbnailsNone:"-- žiadne --",helpLabel:"Nápovedu nájdete na",hideUser:"Skrývať prezývku",highlightUser:"Zvýrazňovať prezývku"}},g={color:GM_getValue("sinner.highlightColor","#ff0000"),domain:GM_getValue("sinner.enforceDomain","."),youtubeThumbnail:GM_getValue("sinner.youtubeThumbnail",0),hideDeleted:GM_getValue("sinner.hideDeleted",false),hideUnregistered:GM_getValue("sinner.hideUnregistered",false),useHighlighting:GM_getValue("sinner.useHighlighting",true),useHiding:GM_getValue("sinner.useHiding",true),transformAnchors:GM_getValue("sinner.transformAnchors",false),domains:new Map([[".",t[t.language].domainsNone],["www.zpovednice.eu","www.zpovednice.eu"],["www.zpovednice.cz","www.zpovednice.cz"],["www.spovednica.sk","www.spovednica.sk"]]),youtubeThumbnails:new Map([[0,{label:t[t.language].thumbnailsNone}],[1,{label:"3 ks (60 x 45)",cnt:3,width:60,height:45,pattern:"https://img.youtube.com/vi/[id]/[i].jpg"}],[2,{label:"3 ks (120 x 90)",cnt:3,width:120,height:90,pattern:"https://img.youtube.com/vi/[id]/[i].jpg"}],[3,{label:"1 ks (320 x 180)",cnt:1,width:320,height:180,pattern:"https://img.youtube.com/vi/[id]/mqdefault.jpg"}],[4,{label:"1 ks (480 x 360)",cnt:1,width:480,height:360,pattern:"https://img.youtube.com/vi/[id]/hqdefault.jpg"}]]),questions:new Map([["ul#highlightUser",t[t.language].questionHighlightUser],["ul#hideUser",t[t.language].questionHideUser],["ul#highlightWord",t[t.language].questionHighlightWord],["ul#hideWord",t[t.language].questionHideWord]])},o=new Map([["homeHighlightUser",{selector:"#conflist li.highlightUser",style:new Map([["font-weight","bold"],["color",g.color]]),index:0}],["postHighlightUser",{selector:"tr.highlightUser, td.highlightUser",style:new Map([["outline-style","outset"],["outline-width","2px"],["outline-color",g.color]]),index:1}],["statsHighlightUser",{selector:"td.highlightStatsUser a",style:new Map([["color",g.color]]),index:2}],["pageHighlightWord",{selector:"span.highlightWord",style:new Map([["color","#000000"],["background-color",g.color]]),index:3}]]),m={i18n:function(e){return t[t.language][e]||"Missing "+t.language+" translation for key "+e},Css:{initializeStylesheet:function(){o.forEach(function(e,t){let n=f.sheet.insertRule(e.selector+" {}",e.index);e.style.forEach(function(e,t){f.sheet.cssRules[n].style[t]=e})})},setStyle:function(e,t,n){let i=o.get(e);f.sheet.cssRules[i.index].style[t]=n},removeClass:function(e){e=typeof e==="string"?[e]:e;e.forEach(function(t){document.querySelectorAll("."+t).forEach(function(e){e.classList.remove(t)})})}},Dom:{removeAllChildNodes:function(e){while(e.firstChild){e.removeChild(e.firstChild)}},formDisablement:function(e,n){let i=document.getElementById(e);n=n||false;for(let e=0,t=i.elements.length;e<t;e++){i.elements[e].disabled=n}},isVip:function(e){let t=e.querySelectorAll("img"),n=["cathome","cathomeh","catclub","catclubh","catmod","catmodh","catvip","catviph"];return t.length&&n.includes(t[t.length-1].src.split("/").pop().split(".").shift())},embedYoutubeThumbnails:function(r,e,t){let o=g.youtubeThumbnails.get(g.youtubeThumbnail);e=e||[];t=t||false;if(e.length===0){return}e.forEach(function(e){let n=Object.assign(document.createElement("div"),{className:"youtubeThumbnails"}),i=e[0],s=e[1];if(t){let e=Object.assign(document.createElement("a"),{href:i,title:i,target:"_blank"}),t=document.createTextNode(i);e.appendChild(t);r.innerHTML=r.innerHTML.replace(i,e.outerHTML)}for(let t=1;t<=o.cnt;t++){let e=Object.assign(document.createElement("img"),{src:o.pattern.replace("[id]",s).replace("[i]",t),width:o.width,height:o.height,className:"youtubeThumbnail"});e.addEventListener("click",function(e){n.insertAdjacentHTML("beforeend",'<div class="embed-container"><iframe src="https://www.youtube.com/embed/'+s+'" frameborder="0" allowfullscreen></iframe></div>');e.target.parentElement.querySelectorAll("img").forEach(function(e){e.remove()})});n.appendChild(e)}r.appendChild(n)})},embedYoutube:function(t){let n=/(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?/g,e=t.querySelectorAll("a");t.querySelectorAll("div.youtubeThumbnails").forEach(function(e){e.remove()});if(e.length>0){e.forEach(function(e){m.Dom.embedYoutubeThumbnails(t,[...e.href.matchAll(n)])})}else{m.Dom.embedYoutubeThumbnails(t,[...t.innerHTML.matchAll(n)],true)}},embedHighlightUserLink:function(e,t,n){let i=Object.assign(document.createElement("a"),{href:"#",title:m.i18n("highlightUser"),className:"highlightUserLink"}),s=Object.assign(document.createElement("img"),{src:"/grafika/s3.gif",width:15,height:15,border:0,align:"bottom",alt:m.i18n("highlightUser")});i.appendChild(s);i.addEventListener("click",function(e){e.preventDefault();e.target.parentElement.parentElement.remove();d.highlightUser(t)});e.prepend(i)},embedHideUserLink:function(e,t){let n=Object.assign(document.createElement("a"),{href:"#",title:m.i18n("hideUser"),className:"hideUserLink"}),i=Object.assign(document.createElement("img"),{src:"/grafika/s8.gif",width:15,height:15,border:0,align:"bottom",alt:m.i18n("hideUser")});n.appendChild(i);n.addEventListener("click",function(e){e.preventDefault();e.target.parentElement.parentElement.remove();d.hideUser(t)});e.prepend(n);e.insertAdjacentHTML("afterbegin","&nbsp;")},embedUserLinks:function(e,t){if(g.useHiding){m.Dom.embedHideUserLink(e,t)}if(g.useHighlighting){m.Dom.embedHighlightUserLink(e,t)}},transformAnchorTargets:function(){if(g.transformAnchors){document.querySelectorAll("a[target='_blank']").forEach(function(e){e.classList.add("transformedAnchor");e.removeAttribute("target")})}else{document.querySelectorAll("a.transformedAnchor").forEach(function(e){e.target="_blank";e.classList.remove("transformedAnchor")})}}},String:{replaceIAll:function(e,t,n){let i=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),s=new RegExp(i,"ig");return e.replace(s,n)},capitalizeFirstLetter:function(e){return e[0].toUpperCase()+e.slice(1)},noAccent:function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")},compress:function(e,t,n,i){let s=e;if(t||false){s=m.String.noAccent(s)}if(n||false){s=s.toLowerCase()}if(i||false){s=s.replaceAll(" ","")}return s},rc4:function(i,s){let r=[],o="";for(let e=0;e<256;e++){r[e]=e}for(let e=0,t=0,n=0;e<256;e++){t=(t+r[e]+i.charCodeAt(e%i.length))%256;n=r[e];r[e]=r[t];r[t]=n}for(let e=0,t=0,n=0,i=0;i<s.length;i++){e=(e+1)%256;t=(t+r[e])%256;n=r[e];r[e]=r[t];r[t]=n;o+=String.fromCharCode(s.charCodeAt(i)^r[(r[e]+r[t])%256])}return o},stripos:function(e,t,n){let i=0;e=(e||"").toLowerCase();t=(t||"").toLowerCase();if((i=e.indexOf(t,n))!==-1){return i}return false},unwrap:function(e){e.outerHTML=e.innerHTML},containsWord:function(e,n){let t=e.innerText.trim(),i=m.String.compress(t,true),s=false;for(let t of n){if(s){continue}let e=m.String.compress(t,true);if(m.String.stripos(i,e)!==false){s=true}}return s},wrapAll:function(e,t,n){let i=e.innerHTML;n=n||"highlightWord";t.forEach(function(e){let t='<span class="'+n+'">'+e+"</span>";i=m.String.replaceIAll(i,e,t)});return i}},Db:{initialize:function(){let e=new Dexie("Sinner");e.version(1).stores({idioms:"$$uuid, [subject+highlight], content"});e.open()["catch"](function(e){console.error("Failed to open database: "+e.stack)});return e},getIdioms:function(e,t,n){t=t||false;n=n||false;return r.idioms.where({subject:e,highlight:t?1:0}).toArray(function(e){let t=[];e.forEach(function(e){t.push(n?m.String.compress(e.content,true,true,true):e.content)});return t})}}},d={getTargetByItem:function(e){return"ul#"+(e.highlight===1?"highlight":"hide")+m.String.capitalizeFirstLetter(e.subject)},getCaptionByItem:function(e){return document.getElementById((e.highlight===1?"highlight":"hide")+m.String.capitalizeFirstLetter(e.subject)+"None")},deleteRecord:function(e){r.idioms.where("uuid").equals(e.uuid)["delete"]().then(function(e){})["catch"](function(e){console.error(e)})},appendItem:function(n){let e=Object.assign(document.createElement("li"),{id:"settingsModal-"+n.uuid}),t=Object.assign(document.createElement("a"),{href:"#"}),i=document.createTextNode(n.content),s=d.getCaptionByItem(n),r=d.getTargetByItem(n),o=g.questions.get(r);t.appendChild(i);t.addEventListener("click",function(e){e.preventDefault();let t={okText:m.i18n("yes"),cancelText:m.i18n("no"),container:document.querySelector("div.tingle-modal-box__content")};DayPilot.Modal.confirm(o,t).then(function(e){if(e.result==="OK"){d.deleteRecord(n)}})});e.appendChild(t);document.querySelector(r).appendChild(e);s.style.display="none"},removeItem:function(t){document.getElementById("settingsModal-"+t.uuid).remove();r.idioms.where({subject:t.subject,highlight:t.highlight}).count().then(function(e){if(e>0){return false}d.getCaptionByItem(t).style.display="inline"})["catch"](function(e){console.error(e)})},colorChangeListener:function(e,t,n,i){g.color=n;m.Css.setStyle("homeHighlightUser","color",n);m.Css.setStyle("postHighlightUser","color",n);m.Css.setStyle("statsHighlightUser","color",n);m.Css.setStyle("pageHighlightWord","background-color",n);if(typeof l!=="undefined"&&i){document.getElementById("colorPicker").value=g.color}},enforceDomain:function(e){if(window.location.hostname===e||e==="."||!g.domains.has(e)){return}let t=window.location.protocol+"//"+e+(window.location.port.length?":"+window.location.port:"")+window.location.pathname+window.location.search+window.location.hash;window.location.assign(t)},domainChangeListener:function(e,t,n,i){d.enforceDomain(n)},youtubeThumbnailChangeListener:function(e,t,n,i){g.youtubeThumbnail=n;s.process()},hideDeletedChangeListener:function(e,t,n,i){g.hideDeleted=n;if(n){s.hideDeleted()}else{s.showDeleted()}},hideUnregisteredChangeListener:function(e,t,n,i){g.hideUnregistered=n;s.process()},useHighlightingChangeListener:function(e,t,n,i){g.useHighlighting=n;s.process()},useHidingChangeListener:function(e,t,n,i){g.useHiding=n;s.process()},transformAnchorsChangeListener:function(e,t,n,i){g.transformAnchors=n;m.Dom.transformAnchorTargets()},showRecords:function(e,t){r.idioms.where({subject:e,highlight:t}).each(function(e){d.appendItem(e)})["catch"](function(e){console.error(e)})},processForm:function(e){let n={subject:e.get("subject"),highlight:parseInt(e.get("highlight")),content:e.get("content").trim()},i={okText:m.i18n("ok"),container:document.querySelector("div.tingle-modal-box__content")};if(n.content.length<3){let e=m.i18n("idiomContentLength").replace("[length]",3);DayPilot.Modal.alert(e,i);return false}document.querySelector("input#sinnerInputContent").value="";r.idioms.where("content").equalsIgnoreCase(n.content).and(function(e){return e.subject===n.subject}).count().then(function(e){if(e>0){let e=n.highlight===1?m.i18n("idiomContentHidden"):m.i18n("idiomContentHighlighted"),t=m.i18n("idiomContentExists").replace("[highlight]",e);DayPilot.Modal.alert(t,i);return false}return r.idioms.add(n)}).then(function(e){})["catch"](function(e){console.error(e)})},hideUser:function(e){let t={subject:"user",highlight:0,content:e.trim()};r.idioms.add(t)},highlightUser:function(e){let t={subject:"user",highlight:1,content:e.trim()};r.idioms.add(t)},observableListener:function(e){e.forEach(function(e){if(e.table!=="idioms"){return}switch(e.type){case 1:d.appendItem(e.obj);break;case 3:d.removeItem(e.oldObj);break}})},backup:function(){let o={okText:m.i18n("settingsSend"),cancelText:m.i18n("settingsCancel"),container:document.querySelector("div.tingle-modal-box__content")};r.idioms.toArray(function(r){o.okText=m.i18n("ok");if(r.length===0){DayPilot.Modal.alert(m.i18n("settingsBackupEmpty"),o);return}DayPilot.Modal.prompt(m.i18n("settingsBackupPassword"),o).then(function(e){if(typeof e.result==="undefined"||e.result.length===0){return}let t=Papa.unparse(r,{quotes:true}),n=m.String.rc4(e.result,t),i=new Blob([n]),s="zpovednicar-"+(new Date).toISOString()+".data";window.saveAs(i,s);DayPilot.Modal.alert(m.i18n("settingsBackupSuccess").replace("[filename]",s),o)})})["catch"](function(e){console.error(e)})},restore:function(){let s={okText:m.i18n("settingsSend"),cancelText:m.i18n("settingsCancel"),container:document.querySelector("div.tingle-modal-box__content")},e=Object.assign(document.createElement("input"),{type:"file"});e.onchange=function(e){let t=e.target.files[0],n=new FileReader;n.readAsText(t,"UTF-8");n.onload=function(e){let i=e.target.result;DayPilot.Modal.prompt(m.i18n("settingsBackupPassword"),s).then(function(e){if(typeof e.result==="undefined"||e.result.length===0){return}let t=m.String.rc4(e.result,i),n=Papa.parse(t,{header:true,dynamicTyping:true});s.okText=m.i18n("ok");if(n.errors.length>0){DayPilot.Modal.alert(m.i18n("settingsRestoreError"),s)}else{r.idioms.clear().then(function(){r.idioms.bulkPut(n.data).then(function(e){DayPilot.Modal.alert(m.i18n("settingsRestoreSuccess"),s)})["catch"](Dexie.BulkError,function(e){console.error(e)})})}})}};e.click()},initializeModal:function(){let t=Object.assign(document.createElement("input"),{type:"hidden",name:"highlight",id:"sinnerInputType",value:"1"}),e=Object.assign(document.createElement("input"),{type:"text",name:"content",id:"sinnerInputContent"}),n=Object.assign(document.createElement("select"),{name:"subject",id:"sinnerInputSubject"}),i=Object.assign(document.createElement("input"),{type:"submit",value:m.i18n("settingsHighlight"),id:"sinnerInputSubmit"}),s=Object.assign(document.createElement("form"),{id:"sinnerDataForm"}),r=false;try{r=!!new Blob}catch(a){r=false}n.appendChild(Object.assign(document.createElement("option"),{value:"user",text:m.i18n("settingsUser")}));n.appendChild(Object.assign(document.createElement("option"),{value:"word",selected:"selected",text:m.i18n("settingsWord")}));s.appendChild(t);s.appendChild(n);s.insertAdjacentHTML("beforeend","&nbsp;");s.appendChild(e);s.insertAdjacentHTML("beforeend","&nbsp;");s.appendChild(i);s.addEventListener("submit",function(e){e.preventDefault();d.processForm(new FormData(e.target))});l=new tingle.modal({footer:true,closeMethods:["overlay","button","escape"],closeLabel:m.i18n("settingsClose"),cssClass:["custom-class-1","custom-class-2"],beforeOpen:function(){m.Dom.removeAllChildNodes(document.querySelector("ul#highlightUser"));document.getElementById("highlightUserNone").style.display="inline";m.Dom.removeAllChildNodes(document.querySelector("ul#highlightWord"));document.getElementById("highlightWordNone").style.display="inline";m.Dom.removeAllChildNodes(document.querySelector("ul#hideUser"));document.getElementById("hideUserNone").style.display="inline";m.Dom.removeAllChildNodes(document.querySelector("ul#hideWord"));document.getElementById("hideWordNone").style.display="inline";d.showRecords("user",1);d.showRecords("user",0);d.showRecords("word",1);d.showRecords("word",0);document.getElementById("colorPicker").value=g.color},beforeClose:function(){e.value="";return true}});let o="<ul data-tabs>"+'<li><a data-tabby-default href="#tabHighlight">'+m.i18n("settingsHighlight")+"</a></li>"+'<li><a href="#tabHide">'+m.i18n("settingsHide")+"</a></li>"+'<li><a href="#tabSettings">'+m.i18n("settingsLabel")+"</a></li>"+"</ul>"+'<div id="tabHighlight">'+"<p>"+'<input type="radio" name="useHighlighting" id="highlightingYes"'+(g.useHighlighting?" checked":"")+' value="1">&nbsp;'+'<label for="highlightingYes">'+m.i18n("enable")+"</label>&nbsp;"+'<input type="radio" name="useHighlighting" id="highlightingNo"'+(g.useHighlighting?"":" checked")+' value="0">&nbsp;'+'<label for="highlightingNo">'+m.i18n("disable")+"</label>"+"</p>"+'<div class="row">'+'<div class="column">'+"<strong>"+m.i18n("settingsUsers")+':</strong>&nbsp;<span id="highlightUserNone">('+m.i18n("settingsNone")+")</span>"+'<ul id="highlightUser" class="sinnerList"></ul>'+"</div>"+'<div class="column">'+"<strong>"+m.i18n("settingsWords")+':</strong>&nbsp;<span id="highlightWordNone">('+m.i18n("settingsNone")+")</span>"+'<ul id="highlightWord" class="sinnerList"></ul>'+"</div>"+"</div>"+"</div>"+'<div id="tabHide">'+"<p>"+'<input type="radio" name="useHiding" id="hidingYes"'+(g.useHiding?" checked":"")+' value="1">&nbsp;'+'<label for="hidingYes">'+m.i18n("enable")+"</label>&nbsp;"+'<input type="radio" name="useHiding" id="hidingNo"'+(g.useHiding?"":" checked")+' value="0">&nbsp;'+'<label for="hidingNo">'+m.i18n("disable")+"</label>"+"</p>"+'<div class="row">'+'<div class="column">'+"<strong>"+m.i18n("settingsUsers")+':</strong>&nbsp;<span id="hideUserNone">('+m.i18n("settingsNone")+")</span>"+'<ul id="hideUser" class="sinnerList"></ul>'+"</div>"+'<div class="column">'+"<strong>"+m.i18n("settingsWords")+':</strong>&nbsp;<span id="hideWordNone">('+m.i18n("settingsNone")+")</span>"+'<ul id="hideWord" class="sinnerList"></ul>'+"</div>"+"</div>"+"</div>"+'<div id="tabSettings">'+'<div class="row">'+'<div class="column">'+"<p>"+m.i18n("helpLabel")+":</p>"+"</div>"+'<div class="column">'+"<p>"+'<a href="https://www.zpovednicar.cz/" target="_blank">www.zpovednicar.cz</a>'+"</p>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+m.i18n("settingsHideDeleted")+":"+"</div>"+'<div class="column">'+'<input type="radio" name="hideDeleted" id="hideDeletedYes"'+(g.hideDeleted?" checked":"")+' value="1">&nbsp;'+'<label for="hideDeletedYes">'+m.i18n("yes")+"</label>&nbsp;"+'<input type="radio" name="hideDeleted" id="hideDeletedNo"'+(g.hideDeleted?"":" checked")+' value="0">&nbsp;'+'<label for="hideDeletedNo">'+m.i18n("no")+"</label>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+"<p>"+m.i18n("settingsHideUnregistered")+":</p>"+"</div>"+'<div class="column">'+"<p>"+'<input type="radio" name="hideUnregistered" id="hideUnregisteredYes"'+(g.hideUnregistered?" checked":"")+' value="1">&nbsp;'+'<label for="hideUnregisteredYes">'+m.i18n("yes")+"</label>&nbsp;"+'<input type="radio" name="hideUnregistered" id="hideUnregisteredNo"'+(g.hideUnregistered?"":" checked")+' value="0">&nbsp;'+'<label for="hideUnregisteredNo">'+m.i18n("no")+"</label>"+"</p>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+m.i18n("settingsTransformAnchors")+":"+"</div>"+'<div class="column">'+'<input type="radio" name="transformAnchors" id="transformAnchorsYes"'+(g.transformAnchors?" checked":"")+' value="1">&nbsp;'+'<label for="transformAnchorsYes">'+m.i18n("yes")+"</label>&nbsp;"+'<input type="radio" name="transformAnchors" id="transformAnchorsNo"'+(g.transformAnchors?"":" checked")+' value="0">&nbsp;'+'<label for="transformAnchorsNo">'+m.i18n("no")+"</label>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+"<p>"+m.i18n("settingsYoutubeThumbnails")+":</p>"+"</div>"+'<div class="column">'+"<p>"+'<select id="youtubeThumbnail">';g.youtubeThumbnails.forEach(function(e,t){o+='<option value="'+t+'"'+(t===g.youtubeThumbnail?" selected":"")+">"+e.label+"</option>"});o+="</select>"+"</p>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+m.i18n("settingsDomain")+"</div>"+'<div class="column">'+'<select id="enforceDomain">';g.domains.forEach(function(e,t){o+='<option value="'+t+'"'+(t===g.domain?" selected":"")+">"+e+"</option>"});o+="</select>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+"<p>"+m.i18n("settingsColor")+":</p>"+"</div>"+'<div class="column">'+'<p class="colorFull"><input type="text" id="colorPicker" value="'+g.color+'"></p>'+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+m.i18n("settingsBackups")+":"+"</div>"+'<div class="column">';if(r){o+='<button id="settingsBackup">'+m.i18n("settingsBackup")+"</button>"+"&nbsp;"+'<button id="settingsRestore">'+m.i18n("settingsRestore")+"</button>"}else{o+=m.i18n("fileSaverUnsupported")}o+="</div>"+"</div>"+"</div>";l.setContent(o);document.getElementById("enforceDomain").onchange=function(e){GM_setValue("sinner.enforceDomain",e.target.value)};document.getElementById("youtubeThumbnail").onchange=function(e){GM_setValue("sinner.youtubeThumbnail",parseInt(e.target.value))};document.querySelectorAll('input[name="useHighlighting"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.useHighlighting",Boolean(parseInt(e.target.value)))})});document.querySelectorAll('input[name="useHiding"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.useHiding",Boolean(parseInt(e.target.value)))})});document.querySelectorAll('input[name="hideDeleted"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.hideDeleted",Boolean(parseInt(e.target.value)))})});document.querySelectorAll('input[name="hideUnregistered"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.hideUnregistered",Boolean(parseInt(e.target.value)))})});document.querySelectorAll('input[name="transformAnchors"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.transformAnchors",Boolean(parseInt(e.target.value)))})});document.querySelector("div.tingle-modal-box__footer").appendChild(s);document.querySelector("div.tingle-modal").addEventListener("tabby",function(e){switch(e.target.hash.substr(1)){case"tabHighlight":m.Dom.formDisablement("sinnerDataForm");t.value=1;i.value=m.i18n("settingsHighlight");document.querySelector("div.tingle-modal-box__footer").style.display="block";break;case"tabHide":m.Dom.formDisablement("sinnerDataForm");t.value=0;i.value=m.i18n("settingsHide");document.querySelector("div.tingle-modal-box__footer").style.display="block";break;default:m.Dom.formDisablement("sinnerDataForm",true);m.Dom.formDisablement("sinnerDataForm",true);document.querySelector("div.tingle-modal-box__footer").style.display="none";break}});if(r){document.getElementById("settingsBackup").addEventListener("click",d.backup);document.getElementById("settingsRestore").addEventListener("click",d.restore)}Coloris({el:"#colorPicker",format:"hex",theme:"polaroid",themeMode:"dark",swatches:["#ff0000","#bf2626","#e76f51","#ffff00","#00ffff","#00ff00"],alpha:false});document.getElementById("colorPicker").addEventListener("change",function(e){GM_setValue("sinner.highlightColor",e.target.value)});l.tabs=new Tabby("[data-tabs]")}};class e{constructor(){this.initialize()}initialize(){r=m.Db.initialize();r.on("changes",this.observableListener);GM_addValueChangeListener("sinner.highlightColor",d.colorChangeListener);GM_addValueChangeListener("sinner.enforceDomain",d.domainChangeListener);GM_addValueChangeListener("sinner.youtubeThumbnail",d.youtubeThumbnailChangeListener);GM_addValueChangeListener("sinner.hideDeleted",d.hideDeletedChangeListener);GM_addValueChangeListener("sinner.hideUnregistered",d.hideUnregisteredChangeListener);GM_addValueChangeListener("sinner.useHighlighting",d.useHighlightingChangeListener);GM_addValueChangeListener("sinner.useHiding",d.useHidingChangeListener);GM_addValueChangeListener("sinner.transformAnchors",d.transformAnchorsChangeListener)}modal(e){e.preventDefault();if(typeof l==="undefined"){d.initializeModal();r.on("changes",d.observableListener)}l.open()}observableListener(e){e.forEach(function(e){if(e.table!=="idioms"){return}s.process()})}async hideDeleted(){}async showDeleted(){}async processUsers(){}async processWords(){}processAnchors(){m.Dom.transformAnchorTargets()}async process(){this.processUsers();this.processWords();this.processAnchors()}}class n extends e{initialize(){super.initialize();let e=document.querySelector("div#ixright").querySelector("div.boxaround").querySelector("div.boxchk"),t=document.createElement("br"),n=Object.assign(document.createElement("a"),{href:"#"}),i=document.createTextNode(m.i18n("menuLabel")),s=Object.assign(document.createElement("img"),{src:"grafika/flarr.gif",width:13,height:11,align:"top",border:0,alt:"Bod"});n.appendChild(s);n.appendChild(i);n.addEventListener("click",this.modal);e.appendChild(t);e.appendChild(n)}async processUsers(){let s=await m.Db.getIdioms("user",true,true),r=await m.Db.getIdioms("user",false,true);m.Css.removeClass(["highlightUser","hiddenUser"]);document.querySelectorAll("li.c4, li.c4u").forEach(function(e){let t=e.innerText.indexOf("("),n=t===-1?e.innerText:e.innerText.slice(0,t-1).trim(),i=m.String.compress(n,true,true,true);if(g.useHighlighting&&s.includes(i)){if(!e.classList.contains("highlightUser")){e.classList.add("highlightUser")}}else if(g.useHiding&&r.includes(i)){if(!e.parentElement.classList.contains("hiddenUser")){e.parentElement.classList.add("hiddenUser")}}})}async processWords(){let i=await m.Db.getIdioms("word",true),s=await m.Db.getIdioms("word",false);m.Css.removeClass("hiddenWord");document.querySelectorAll(".highlightWord").forEach(function(e){m.String.unwrap(e)});document.querySelectorAll("li.c3 a, li.c3l a").forEach(function(e){let t=false,n;if(g.useHiding&&(t=m.String.containsWord(e,s))!==false){e.parentElement.parentElement.classList.add("hiddenWord")}if(!t&&g.useHighlighting){if((n=m.String.wrapAll(e,i))!==false){e.innerHTML=n}}})}}class i extends e{async processUsers(){let c=await m.Db.getIdioms("user",true,true),u=await m.Db.getIdioms("user",false,true),e=document.querySelector("span.signunreg, span.signnick"),h=window.location.pathname.startsWith("/zpovperl.php"),n=e.innerText.trim(),t=m.String.compress(n,true,true,true),i=e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;m.Css.removeClass(["highlightUser","hiddenUser","strikeUser"]);document.querySelectorAll(".userLinks").forEach(function(e){m.Dom.removeAllChildNodes(e);e.remove()});if(g.useHighlighting&&c.includes(t)){if(!i.classList.contains("highlightUser")){i.classList.add("highlightUser")}}else if(g.useHiding&&u.includes(t)){if(!e.classList.contains("strikeUser")){e.classList.add("strikeUser")}}else if(!h){let e=document.querySelectorAll("td.conftext")[1].querySelectorAll("td.signinfo")[1],t=Object.assign(document.createElement("span"),{className:"userLinks"});e.prepend(t);m.Dom.embedUserLinks(t,n)}document.querySelectorAll("td.signunreg, td.signnick").forEach(function(e){let t=e.innerText.trim(),n=m.String.compress(t,true,true,true),i=e.parentElement,s=i.querySelector("td.signinfo"),r=s.childElementCount!==0,o=i.parentElement.parentElement.parentElement.parentElement,a=o.previousElementSibling,l=a.previousElementSibling,d=[o,a,l];if(!h&&g.hideUnregistered&&!r){d.forEach(function(e){if(!e.classList.contains("hiddenUser")){e.classList.add("hiddenUser")}})}if(g.useHighlighting&&c.includes(n)){if(!i.classList.contains("highlightUser")){i.classList.add("highlightUser")}}else if(g.useHiding&&u.includes(n)){d.forEach(function(e){if(!e.classList.contains("hiddenUser")){e.classList.add("hiddenUser")}})}else{let e=Object.assign(document.createElement("span"),{className:"userLinks"});s.prepend(e);m.Dom.embedUserLinks(e,t)}})}async processWords(){let a=await m.Db.getIdioms("word",true),l=await m.Db.getIdioms("word",false),e=document.querySelector("td.confheader"),t=document.querySelectorAll("td.conftext"),n=t[0],i=t[1].querySelectorAll("td.signinfo")[1],d;m.Css.removeClass("hiddenWord");document.querySelectorAll(".strikeWord").forEach(function(e){m.String.unwrap(e)});document.querySelectorAll(".highlightWord").forEach(function(e){m.String.unwrap(e)});if(g.useHiding){if((d=m.String.wrapAll(e,l,"strikeWord"))!==false){e.innerHTML=d}if((d=m.String.wrapAll(n,l,"strikeWord"))!==false){n.innerHTML=d}}if(g.useHighlighting){if((d=m.String.wrapAll(e,a))!==false){e.innerHTML=d}if((d=m.String.wrapAll(n,a))!==false){n.innerHTML=d}}if(m.Dom.isVip(i)){m.Dom.embedYoutube(n)}document.querySelectorAll("td.signunreg, td.signnick").forEach(function(e){let t=e.parentElement.parentElement.parentElement.parentElement.parentElement,n=t.previousElementSibling.previousElementSibling,i=t.previousElementSibling.firstElementChild,s=[t,n,i.parentElement],r=m.Dom.isVip(e.nextElementSibling),o=false;if(g.useHiding&&(o=m.String.containsWord(i,l))!==false){s.forEach(function(e){e.classList.add("hiddenWord")})}if(!o){if(g.useHighlighting){if((d=m.String.wrapAll(i,a))!==false){i.innerHTML=d}}if(r){m.Dom.embedYoutube(i)}}})}async hideDeleted(){document.querySelectorAll("td.infortext").forEach(function(e){let t=[e.parentElement,e.parentElement.previousElementSibling,e.parentElement.nextElementSibling],n=e.parentElement.previousElementSibling.previousElementSibling.firstElementChild.firstElementChild.innerHTML.trim();if(n.length===0){t.push(e.parentElement.previousElementSibling.previousElementSibling)}t.forEach(function(e){e.classList.add("hiddenDeleted")})})}async showDeleted(){document.querySelectorAll("tr.hiddenDeleted").forEach(function(e){e.classList.remove("hiddenDeleted")})}async process(){super.process();if(g.hideDeleted){this.hideDeleted()}}}class a extends e{async processUsers(){let o=await m.Db.getIdioms("user",true,true),a=await m.Db.getIdioms("user",false,true),e=document.querySelector("td.profheader"),t=e.innerText.trim(),n=document.querySelector("table.infoltext tbody").firstElementChild.firstElementChild,i=m.String.compress(t,true,true,true),s=e.parentElement;m.Css.removeClass(["highlightUser","hiddenUser","strikeUser"]);document.querySelectorAll(".userLinks").forEach(function(e){m.Dom.removeAllChildNodes(e);e.remove()});if(g.useHighlighting&&o.includes(i)){if(!s.classList.contains("highlightUser")){s.classList.add("highlightUser")}}else if(g.useHiding&&a.includes(i)){if(!e.classList.contains("strikeUser")){e.classList.add("strikeUser")}}else{let e=Object.assign(document.createElement("span"),{className:"userLinks"});n.appendChild(e);m.Dom.embedUserLinks(e,t);e.insertAdjacentHTML("afterbegin","&nbsp;")}document.querySelectorAll("span.guestnote, span.guestnick").forEach(function(t){let e=t.innerText.indexOf("(")===-1,n=e?t.innerText.indexOf(":"):t.innerText.indexOf("(")-1,i=t.innerText.slice(0,n).trim(),s=m.String.compress(i,true,true,true),r=t.parentElement.parentElement;if(g.hideUnregistered&&!e){if(!r.classList.contains("hiddenUser")){r.classList.add("hiddenUser")}}if(g.useHighlighting&&o.includes(s)){if(!r.classList.contains("highlightUser")){r.classList.add("highlightUser")}}else if(g.useHiding&&a.includes(s)){if(!r.classList.contains("hiddenUser")){r.classList.add("hiddenUser")}}else{let e=Object.assign(document.createElement("span"),{className:"userLinks"});t.prepend(e);m.Dom.embedUserLinks(e,i)}})}async processWords(){let i=await m.Db.getIdioms("word",true),s=await m.Db.getIdioms("word",false);m.Css.removeClass("hiddenWord");document.querySelectorAll(".highlightWord").forEach(function(e){m.String.unwrap(e)});document.querySelectorAll("div.guesttext").forEach(function(e){let t=false,n;if(g.useHiding&&(t=m.String.containsWord(e,s))!==false){e.parentElement.parentElement.classList.add("hiddenWord")}if(!t&&g.useHighlighting){if((n=m.String.wrapAll(e,i))!==false){e.innerHTML=n}}})}}class c extends e{async processUsers(){let o=await m.Db.getIdioms("user",true,true),a=await m.Db.getIdioms("user",false,true);m.Css.removeClass(["highlightUser","hiddenUser"]);document.querySelectorAll(".userLinks").forEach(function(e){m.Dom.removeAllChildNodes(e);e.remove()});document.querySelectorAll("span.guestnote, span.guestnick").forEach(function(t){let e=t.innerText.indexOf("(")===-1,n=t.innerText.indexOf("(")===-1?t.innerText.indexOf(":"):t.innerText.indexOf("(")-1,i=t.innerText.slice(0,n).trim(),s=m.String.compress(i,true,true,true),r=t.parentElement.parentElement;if(g.hideUnregistered&&!e){if(!r.classList.contains("hiddenUser")){r.classList.add("hiddenUser")}}if(g.useHighlighting&&o.includes(s)){if(!r.classList.contains("highlightUser")){r.classList.add("highlightUser")}}else if(g.useHiding&&a.includes(s)){if(!r.classList.contains("hiddenUser")){r.classList.add("hiddenUser")}}else{let e=Object.assign(document.createElement("span"),{className:"userLinks"});t.prepend(e);m.Dom.embedUserLinks(e,i)}})}async processWords(){let i=await m.Db.getIdioms("word",true),s=await m.Db.getIdioms("word",false);document.querySelectorAll(".highlightWord").forEach(function(e){m.String.unwrap(e)});document.querySelectorAll(".hiddenWord").forEach(function(e){e.classList.remove("hiddenWord")});document.querySelectorAll("div.guesttext").forEach(function(e){let t=false,n;if(g.useHiding&&(t=m.String.containsWord(e,s))!==false){e.parentElement.parentElement.classList.add("hiddenWord")}if(!t&&g.useHighlighting){if((n=m.String.wrapAll(e,i))!==false){e.innerHTML=n}}})}}class u extends e{async processUsers(n){let i=await m.Db.getIdioms("user",true,true),s=await m.Db.getIdioms("user",false,true),r=0;n=n||0;m.Css.removeClass(["highlightStatsUser","hiddenUser"]);document.querySelectorAll("td.lstconf").forEach(function(e){if(r++<n){return}let t=m.String.compress(e.innerText,true,true,true);if(g.useHighlighting&&i.includes(t)){if(!e.classList.contains("highlightStatsUser")){e.classList.add("highlightStatsUser")}}else if(g.useHiding&&s.includes(t)){if(!e.parentElement.classList.contains("hiddenUser")){e.parentElement.classList.add("hiddenUser")}}})}async processWords(i){let s=await m.Db.getIdioms("word",true),r=await m.Db.getIdioms("word",false),o=0;i=i||0;document.querySelectorAll(".highlightWord").forEach(function(e){m.String.unwrap(e)});document.querySelectorAll(".hiddenWord").forEach(function(e){e.classList.remove("hiddenWord")});document.querySelectorAll("td.lstconf").forEach(function(e){let t=false,n;if(i>0&&++o>i){return}if(g.useHiding&&(t=m.String.containsWord(e,r))!==false){e.parentElement.classList.add("hiddenWord")}if(!t&&g.useHighlighting){if((n=m.String.wrapAll(e,s))!==false){e.innerHTML=n}}})}async process(){switch(window.location.search){case"?prehled=4":this.processUsers();break;case"?prehled=3":this.processUsers(40);this.processWords(40);break;case"?prehled=2":this.processUsers(20);this.processWords(20);break;case"?prehled=1":default:this.processWords();break}this.processAnchors()}}if(g.domain!=="."&&window.location.hostname!==g.domain){d.enforceDomain(g.domain);return}let h=window.location.pathname,p=h==="/"?"index":h.substring(1,h.indexOf(".php"));switch(p){case"index":s=new n;break;case"detail":case"zpovperl":s=new i;break;case"profil":s=new a;break;case"kniha":s=new c;break;case"stat":s=new u;break;default:console.error("ZPOVEDNICAR unknown page "+p);return}m.Css.initializeStylesheet();GM_registerMenuCommand(m.i18n("settingsLabel"),s.modal);s.process()});
