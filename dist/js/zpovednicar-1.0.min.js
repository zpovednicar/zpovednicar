"use strict";for(let e of["CSS_TINGLE","CSS_TABBY","CSS_MODAL","CSS_PICKER","CSS_CUSTOM"]){GM_addStyle(GM_getResourceText(e))}const f=function(){let e=document.createElement("style");e.appendChild(document.createTextNode(""));document.head.appendChild(e);return e}();function e(e){if(document.readyState!=="loading"){e()}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",e)}else{document.attachEvent("onreadystatechange",function(){if(document.readyState=="complete")e()})}}e(function(){let o,s,a;const t={language:window.location.hostname.match(/^(www\.)?spovednica\.sk$/)?"sk":"cz",cz:{yes:"Ano",no:"Ne",ok:"Rozumím",menuLabel:"ZPOVĚDNIČÁŘ",enable:"zapnout",disable:"vypnout",comingSoon:"už brzy",domainsNone:"-- nepoužívat --",questionHighlightUser:"Opravdu smazat zvýrazněného uživatele?",questionHideUser:"Opravdu smazat skrývaného uživatele?",questionHighlightWord:"Opravdu smazat zvýrazněný výraz?",questionHideWord:"Opravdu smazat skrývaný výraz?",settingsSubmit:"Uložit",settingsSend:"Odeslat",settingsCancel:"Zrušit",settingsUser:"přezdívka",settingsWord:"výraz",settingsClose:"Zavřít",settingsHighlight:"Zvýrazňovat",settingsHide:"Skrývat",settingsLabel:"Nastavení",settingsUsers:"Přezdívky",settingsWords:"Výrazy",settingsNone:"žádné",settingsColor:"Barva zvýraznění",settingsDomain:"Vynutit doménu",settingsHideDeleted:"Skrývat smazané",settingsHideUnregistered:"Skrývat neregistrované",settingsYoutubeThumbnails:"Náhledy Youtube videí",idiomContentLength:"Minimální délka jsou [length] znaky",idiomContentExists:"Záznam existuje ve [highlight], obojí najednou není možné",idiomContentHighlighted:"zvýrazňovaných",idiomContentHidden:"skrývaných",fileSaverUnsupported:"Nepodporováno vaším prohlížečem",settingsBackups:"Zálohování",settingsBackup:"Zálohovat",settingsBackupEmpty:"Databáze je prázdná, není co zálohovat",settingsBackupPassword:"Heslo pro soubor se zálohou",settingsBackupSuccess:"Záloha proběhla úspěšně, stahuje se soubor:<br><br>[filename]",settingsRestore:"Obnovit",settingsRestoreError:"Neplatné heslo nebo poškozený soubor se zálohou",settingsRestoreSuccess:"Obnova ze zálohy proběhla úspěšně",thumbnailsNone:"-- žádné --",helpLabel:"Nápovědu najdete na",hideUser:"Skrývat přezdívku",highlightUser:"Zvýrazňovat přezdívku"},sk:{yes:"Áno",no:"Nie",ok:"Rozumiem",menuLabel:"SPOVEDNIČIAR",enable:"zapnúť",disable:"vypnúť",comingSoon:"už čoskoro",domainsNone:"-- nepoužívať --",questionHighlightUser:"Naozaj zmazať zvýrazneného užívateľa?",questionHideUser:"Naozaj zmazať skrývaného užívateľa?",questionHighlightWord:"Naozaj zmazať zvýraznený výraz?",questionHideWord:"Naozaj zmazať skrývaný výraz?",settingsSubmit:"Uložiť",settingsSend:"Odoslať",settingsCancel:"Zrušiť",settingsUser:"prezývka",settingsWord:"výraz",settingsClose:"Zavrieť",settingsHighlight:"Zvýrazňovať",settingsHide:"Skrývať",settingsLabel:"Nastavenia",settingsUsers:"Prezývky",settingsWords:"Výrazy",settingsNone:"žiadne",settingsColor:"Farba zvýraznenia",settingsDomain:"Vynútiť doménu",settingsHideDeleted:"Skrývať zmazané",settingsHideUnregistered:"Skrývať neregistrované",settingsYoutubeThumbnails:"Náhľady Youtube videí",idiomContentLength:"Minimálna dĺžka sú [length] znaky",idiomContentExists:"Záznam existuje vo [highlight], oboje naraz nie je možné",idiomContentHighlighted:"zvýrazňovaných",idiomContentHidden:"skrývaných",fileSaverUnsupported:"Nepodporované vašim prehliadačom",settingsBackups:"Zálohovanie",settingsBackup:"Zálohovať",settingsBackupEmpty:"Databáza je prázdna, nie je čo zálohovať",settingsBackupPassword:"Heslo pre súbor so zálohou",settingsBackupSuccess:"Záloha prebehla úspešne, sťahuje sa súbor:<br><br>[filename]",settingsRestore:"Obnoviť",settingsRestoreError:"Neplatné heslo alebo poškodený súbor so zálohou",settingsRestoreSuccess:"Obnova zo zálohy prebehla úspešne",thumbnailsNone:"-- žiadne --",helpLabel:"Nápovedu nájdete na",hideUser:"Skrývať prezývku",highlightUser:"Zvýrazňovať prezývku"}},h={color:GM_getValue("sinner.highlightColor","#ff0000"),domain:GM_getValue("sinner.enforceDomain","."),youtubeThumbnail:GM_getValue("sinner.youtubeThumbnail",0),hideDeleted:GM_getValue("sinner.hideDeleted",false),hideUnregistered:GM_getValue("sinner.hideUnregistered",false),useHighlighting:GM_getValue("sinner.useHighlighting",true),useHiding:GM_getValue("sinner.useHiding",true),domains:new Map([[".",t[t.language].domainsNone],["www.zpovednice.eu","www.zpovednice.eu"],["www.zpovednice.cz","www.zpovednice.cz"],["www.spovednica.sk","www.spovednica.sk"]]),youtubeThumbnails:new Map([[0,{label:t[t.language].thumbnailsNone}],[1,{label:"3 ks (60 x 45)",cnt:3,width:60,height:45,pattern:"https://img.youtube.com/vi/[id]/[i].jpg"}],[2,{label:"3 ks (120 x 90)",cnt:3,width:120,height:90,pattern:"https://img.youtube.com/vi/[id]/[i].jpg"}],[3,{label:"1 ks (320 x 180)",cnt:1,width:320,height:180,pattern:"https://img.youtube.com/vi/[id]/mqdefault.jpg"}],[4,{label:"1 ks (480 x 360)",cnt:1,width:480,height:360,pattern:"https://img.youtube.com/vi/[id]/hqdefault.jpg"}]]),questions:new Map([["ul#highlightUser",t[t.language].questionHighlightUser],["ul#hideUser",t[t.language].questionHideUser],["ul#highlightWord",t[t.language].questionHighlightWord],["ul#hideWord",t[t.language].questionHideWord]])},r=new Map([["homeHighlightUser",{selector:"#conflist li.highlightUser",style:new Map([["font-weight","bold"],["color",h.color]]),index:0}],["postHighlightUser",{selector:"tr.highlightUser, td.highlightUser",style:new Map([["outline-style","outset"],["outline-width","2px"],["outline-color",h.color]]),index:1}],["statsHighlightUser",{selector:"td.highlightStatsUser a",style:new Map([["color",h.color]]),index:2}],["pageHighlightWord",{selector:"span.highlightWord",style:new Map([["color","#000000"],["background-color",h.color]]),index:3}]]),g={i18n:function(e){return t[t.language][e]||"Missing "+t.language+" translation for key "+e},Css:{initializeStylesheet:function(){r.forEach(function(e,t){let n=f.sheet.insertRule(e.selector+" {}",e.index);e.style.forEach(function(e,t){f.sheet.cssRules[n].style[t]=e})})},setStyle:function(e,t,n){let i=r.get(e);f.sheet.cssRules[i.index].style[t]=n},removeClass:function(e){e=typeof e==="string"?[e]:e;e.forEach(function(t){document.querySelectorAll("."+t).forEach(function(e){e.classList.remove(t)})})}},Dom:{removeAllChildNodes:function(e){while(e.firstChild){e.removeChild(e.firstChild)}},formDisablement:function(e,n){let i=document.getElementById(e);n=n||false;for(let e=0,t=i.elements.length;e<t;e++){i.elements[e].disabled=n}},isVip:function(e){let t=e.querySelectorAll("img"),n=["cathome","cathomeh","catclub","catclubh","catmod","catmodh","catvip","catviph"];return t.length&&n.includes(t[t.length-1].src.split("/").pop().split(".").shift())},embedYoutubeThumbnails:function(o,e,t){let r=h.youtubeThumbnails.get(h.youtubeThumbnail);e=e||[];t=t||false;if(e.length===0){return}e.forEach(function(e){let n=Object.assign(document.createElement("div"),{className:"youtubeThumbnails"}),i=e[0],s=e[1];if(t){let e=Object.assign(document.createElement("a"),{href:i,title:i,target:"_blank"}),t=document.createTextNode(i);e.appendChild(t);o.innerHTML=o.innerHTML.replace(i,e.outerHTML)}for(let t=1;t<=r.cnt;t++){let e=Object.assign(document.createElement("img"),{src:r.pattern.replace("[id]",s).replace("[i]",t),width:r.width,height:r.height,className:"youtubeThumbnail"});e.addEventListener("click",function(e){n.insertAdjacentHTML("beforeend",'<div class="embed-container"><iframe src="https://www.youtube.com/embed/'+s+'" frameborder="0" allowfullscreen></iframe></div>');e.target.parentElement.querySelectorAll("img").forEach(function(e){e.remove()})});n.appendChild(e)}o.appendChild(n)})},embedYoutube:function(t){let n=/(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?/g,e=t.querySelectorAll("a");t.querySelectorAll("div.youtubeThumbnails").forEach(function(e){e.remove()});if(e.length>0){e.forEach(function(e){g.Dom.embedYoutubeThumbnails(t,[...e.href.matchAll(n)])})}else{g.Dom.embedYoutubeThumbnails(t,[...t.innerHTML.matchAll(n)],true)}},embedHighlightUserLink:function(e,t,n){let i=Object.assign(document.createElement("a"),{href:"#",title:g.i18n("highlightUser"),className:"highlightUserLink"}),s=Object.assign(document.createElement("img"),{src:"/grafika/s3.gif",width:15,height:15,border:0,align:"bottom",alt:g.i18n("highlightUser")});i.appendChild(s);i.addEventListener("click",function(e){e.preventDefault();e.target.parentElement.parentElement.remove();d.highlightUser(t)});e.prepend(i)},embedHideUserLink:function(e,t){let n=Object.assign(document.createElement("a"),{href:"#",title:g.i18n("hideUser"),className:"hideUserLink"}),i=Object.assign(document.createElement("img"),{src:"/grafika/s8.gif",width:15,height:15,border:0,align:"bottom",alt:g.i18n("hideUser")});n.appendChild(i);n.addEventListener("click",function(e){e.preventDefault();e.target.parentElement.parentElement.remove();d.hideUser(t)});e.prepend(n);e.insertAdjacentHTML("afterbegin","&nbsp;")},embedUserLinks:function(e,t){if(h.useHiding){g.Dom.embedHideUserLink(e,t)}if(h.useHighlighting){g.Dom.embedHighlightUserLink(e,t)}}},String:{replaceIAll:function(e,t,n){let i=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),s=new RegExp(i,"ig");return e.replace(s,n)},capitalizeFirstLetter:function(e){return e[0].toUpperCase()+e.slice(1)},noAccent:function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")},compress:function(e,t,n,i){let s=e;if(t||false){s=g.String.noAccent(s)}if(n||false){s=s.toLowerCase()}if(i||false){s=s.replaceAll(" ","")}return s},rc4:function(i,s){let o=[],r="";for(let e=0;e<256;e++){o[e]=e}for(let e=0,t=0,n=0;e<256;e++){t=(t+o[e]+i.charCodeAt(e%i.length))%256;n=o[e];o[e]=o[t];o[t]=n}for(let e=0,t=0,n=0,i=0;i<s.length;i++){e=(e+1)%256;t=(t+o[e])%256;n=o[e];o[e]=o[t];o[t]=n;r+=String.fromCharCode(s.charCodeAt(i)^o[(o[e]+o[t])%256])}return r},stripos:function(e,t,n){let i=0;e=(e||"").toLowerCase();t=(t||"").toLowerCase();if((i=e.indexOf(t,n))!==-1){return i}return false},unwrap:function(e){e.outerHTML=e.innerHTML},containsWord:function(e,n){let t=e.innerText.trim(),i=g.String.compress(t,true),s=false;for(let t of n){if(s){continue}let e=g.String.compress(t,true);if(g.String.stripos(i,e)!==false){s=true}}return s},wrapAll:function(e,t,n){let i=e.innerHTML;n=n||"highlightWord";t.forEach(function(e){let t='<span class="'+n+'">'+e+"</span>";i=g.String.replaceIAll(i,e,t)});return i}},Db:{initialize:function(){let e=new Dexie("Sinner");e.version(1).stores({idioms:"$$uuid, [subject+highlight], content"});e.open()["catch"](function(e){console.error("Failed to open database: "+e.stack)});return e},getIdioms:function(e,t,n){t=t||false;n=n||false;return o.idioms.where({subject:e,highlight:t?1:0}).toArray(function(e){let t=[];e.forEach(function(e){t.push(n?g.String.compress(e.content,true,true,true):e.content)});return t})}}},d={getTargetByItem:function(e){return"ul#"+(e.highlight===1?"highlight":"hide")+g.String.capitalizeFirstLetter(e.subject)},getCaptionByItem:function(e){return document.getElementById((e.highlight===1?"highlight":"hide")+g.String.capitalizeFirstLetter(e.subject)+"None")},deleteRecord:function(e){o.idioms.where("uuid").equals(e.uuid)["delete"]().then(function(e){})["catch"](function(e){console.error(e)})},appendItem:function(n){let e=Object.assign(document.createElement("li"),{id:"settingsModal-"+n.uuid}),t=Object.assign(document.createElement("a"),{href:"#"}),i=document.createTextNode(n.content),s=d.getCaptionByItem(n),o=d.getTargetByItem(n),r=h.questions.get(o);t.appendChild(i);t.addEventListener("click",function(e){e.preventDefault();let t={okText:g.i18n("yes"),cancelText:g.i18n("no"),container:document.querySelector("div.tingle-modal-box__content")};DayPilot.Modal.confirm(r,t).then(function(e){if(e.result==="OK"){d.deleteRecord(n)}})});e.appendChild(t);document.querySelector(o).appendChild(e);s.style.display="none"},removeItem:function(t){document.getElementById("settingsModal-"+t.uuid).remove();o.idioms.where({subject:t.subject,highlight:t.highlight}).count().then(function(e){if(e>0){return false}d.getCaptionByItem(t).style.display="inline"})["catch"](function(e){console.error(e)})},colorChangeListener:function(e,t,n,i){h.color=n;g.Css.setStyle("homeHighlightUser","color",n);g.Css.setStyle("postHighlightUser","color",n);g.Css.setStyle("statsHighlightUser","color",n);g.Css.setStyle("pageHighlightWord","background-color",n);if(typeof a!=="undefined"&&i){document.getElementById("colorPicker").value=h.color}},enforceDomain:function(e){if(window.location.hostname===e||e==="."||!h.domains.has(e)){return}let t=window.location.protocol+"//"+e+(window.location.port.length?":"+window.location.port:"")+window.location.pathname+window.location.search+window.location.hash;window.location.assign(t)},domainChangeListener:function(e,t,n,i){d.enforceDomain(n)},youtubeThumbnailChangeListener:function(e,t,n,i){h.youtubeThumbnail=n;s.process()},hideDeletedChangeListener:function(e,t,n,i){h.hideDeleted=n;if(n){s.hideDeleted()}else{s.showDeleted()}},hideUnregisteredChangeListener:function(e,t,n,i){h.hideUnregistered=n;s.process()},useHighlightingChangeListener:function(e,t,n,i){h.useHighlighting=n;s.process()},useHidingChangeListener:function(e,t,n,i){h.useHiding=n;s.process()},showRecords:function(e,t){o.idioms.where({subject:e,highlight:t}).each(function(e){d.appendItem(e)})["catch"](function(e){console.error(e)})},processForm:function(e){let n={subject:e.get("subject"),highlight:parseInt(e.get("highlight")),content:e.get("content").trim()},i={okText:g.i18n("ok"),container:document.querySelector("div.tingle-modal-box__content")};if(n.content.length<3){let e=g.i18n("idiomContentLength").replace("[length]",3);DayPilot.Modal.alert(e,i);return false}document.querySelector("input#sinnerInputContent").value="";o.idioms.where("content").equalsIgnoreCase(n.content).and(function(e){return e.subject===n.subject}).count().then(function(e){if(e>0){let e=n.highlight===1?g.i18n("idiomContentHidden"):g.i18n("idiomContentHighlighted"),t=g.i18n("idiomContentExists").replace("[highlight]",e);DayPilot.Modal.alert(t,i);return false}return o.idioms.add(n)}).then(function(e){})["catch"](function(e){console.error(e)})},hideUser:function(e){let t={subject:"user",highlight:0,content:e.trim()};o.idioms.add(t)},highlightUser:function(e){let t={subject:"user",highlight:1,content:e.trim()};o.idioms.add(t)},observableListener:function(e){e.forEach(function(e){if(e.table!=="idioms"){return}switch(e.type){case 1:d.appendItem(e.obj);break;case 3:d.removeItem(e.oldObj);break}})},backup:function(){let r={okText:g.i18n("settingsSend"),cancelText:g.i18n("settingsCancel"),container:document.querySelector("div.tingle-modal-box__content")};o.idioms.toArray(function(o){r.okText=g.i18n("ok");if(o.length===0){DayPilot.Modal.alert(g.i18n("settingsBackupEmpty"),r);return}DayPilot.Modal.prompt(g.i18n("settingsBackupPassword"),r).then(function(e){if(typeof e.result==="undefined"||e.result.length===0){return}let t=Papa.unparse(o,{quotes:true}),n=g.String.rc4(e.result,t),i=new Blob([n]),s="zpovednicar-"+(new Date).toISOString()+".data";window.saveAs(i,s);DayPilot.Modal.alert(g.i18n("settingsBackupSuccess").replace("[filename]",s),r)})})["catch"](function(e){console.error(e)})},restore:function(){let s={okText:g.i18n("settingsSend"),cancelText:g.i18n("settingsCancel"),container:document.querySelector("div.tingle-modal-box__content")},e=Object.assign(document.createElement("input"),{type:"file"});e.onchange=function(e){let t=e.target.files[0],n=new FileReader;n.readAsText(t,"UTF-8");n.onload=function(e){let i=e.target.result;DayPilot.Modal.prompt(g.i18n("settingsBackupPassword"),s).then(function(e){if(typeof e.result==="undefined"||e.result.length===0){return}let t=g.String.rc4(e.result,i),n=Papa.parse(t,{header:true,dynamicTyping:true});s.okText=g.i18n("ok");if(n.errors.length>0){DayPilot.Modal.alert(g.i18n("settingsRestoreError"),s)}else{o.idioms.clear().then(function(){o.idioms.bulkPut(n.data).then(function(e){DayPilot.Modal.alert(g.i18n("settingsRestoreSuccess"),s)})["catch"](Dexie.BulkError,function(e){console.error(e)})})}})}};e.click()},initializeModal:function(){let t=Object.assign(document.createElement("input"),{type:"hidden",name:"highlight",id:"sinnerInputType",value:"1"}),e=Object.assign(document.createElement("input"),{type:"text",name:"content",id:"sinnerInputContent"}),n=Object.assign(document.createElement("select"),{name:"subject",id:"sinnerInputSubject"}),i=Object.assign(document.createElement("input"),{type:"submit",value:g.i18n("settingsHighlight"),id:"sinnerInputSubmit"}),s=Object.assign(document.createElement("form"),{id:"sinnerDataForm"}),o=false;try{o=!!new Blob}catch(l){o=false}n.appendChild(Object.assign(document.createElement("option"),{value:"user",text:g.i18n("settingsUser")}));n.appendChild(Object.assign(document.createElement("option"),{value:"word",selected:"selected",text:g.i18n("settingsWord")}));s.appendChild(t);s.appendChild(n);s.insertAdjacentHTML("beforeend","&nbsp;");s.appendChild(e);s.insertAdjacentHTML("beforeend","&nbsp;");s.appendChild(i);s.addEventListener("submit",function(e){e.preventDefault();d.processForm(new FormData(e.target))});a=new tingle.modal({footer:true,closeMethods:["overlay","button","escape"],closeLabel:g.i18n("settingsClose"),cssClass:["custom-class-1","custom-class-2"],beforeOpen:function(){g.Dom.removeAllChildNodes(document.querySelector("ul#highlightUser"));document.getElementById("highlightUserNone").style.display="inline";g.Dom.removeAllChildNodes(document.querySelector("ul#highlightWord"));document.getElementById("highlightWordNone").style.display="inline";g.Dom.removeAllChildNodes(document.querySelector("ul#hideUser"));document.getElementById("hideUserNone").style.display="inline";g.Dom.removeAllChildNodes(document.querySelector("ul#hideWord"));document.getElementById("hideWordNone").style.display="inline";d.showRecords("user",1);d.showRecords("user",0);d.showRecords("word",1);d.showRecords("word",0);document.getElementById("colorPicker").value=h.color},beforeClose:function(){e.value="";return true}});let r="<ul data-tabs>"+'<li><a data-tabby-default href="#tabHighlight">'+g.i18n("settingsHighlight")+"</a></li>"+'<li><a href="#tabHide">'+g.i18n("settingsHide")+"</a></li>"+'<li><a href="#tabSettings">'+g.i18n("settingsLabel")+"</a></li>"+"</ul>"+'<div id="tabHighlight">'+"<p>"+'<input type="radio" name="useHighlighting" id="highlightingYes"'+(h.useHighlighting?" checked":"")+' value="1">&nbsp;'+'<label for="highlightingYes">'+g.i18n("enable")+"</label>&nbsp;"+'<input type="radio" name="useHighlighting" id="highlightingNo"'+(h.useHighlighting?"":" checked")+' value="0">&nbsp;'+'<label for="highlightingNo">'+g.i18n("disable")+"</label>"+"</p>"+'<div class="row">'+'<div class="column">'+"<strong>"+g.i18n("settingsUsers")+':</strong>&nbsp;<span id="highlightUserNone">('+g.i18n("settingsNone")+")</span>"+'<ul id="highlightUser" class="sinnerList"></ul>'+"</div>"+'<div class="column">'+"<strong>"+g.i18n("settingsWords")+':</strong>&nbsp;<span id="highlightWordNone">('+g.i18n("settingsNone")+")</span>"+'<ul id="highlightWord" class="sinnerList"></ul>'+"</div>"+"</div>"+"</div>"+'<div id="tabHide">'+"<p>"+'<input type="radio" name="useHiding" id="hidingYes"'+(h.useHiding?" checked":"")+' value="1">&nbsp;'+'<label for="hidingYes">'+g.i18n("enable")+"</label>&nbsp;"+'<input type="radio" name="useHiding" id="hidingNo"'+(h.useHiding?"":" checked")+' value="0">&nbsp;'+'<label for="hidingNo">'+g.i18n("disable")+"</label>"+"</p>"+'<div class="row">'+'<div class="column">'+"<strong>"+g.i18n("settingsUsers")+':</strong>&nbsp;<span id="hideUserNone">('+g.i18n("settingsNone")+")</span>"+'<ul id="hideUser" class="sinnerList"></ul>'+"</div>"+'<div class="column">'+"<strong>"+g.i18n("settingsWords")+':</strong>&nbsp;<span id="hideWordNone">('+g.i18n("settingsNone")+")</span>"+'<ul id="hideWord" class="sinnerList"></ul>'+"</div>"+"</div>"+"</div>"+'<div id="tabSettings">'+'<div class="row">'+'<div class="column">'+"<p>"+g.i18n("helpLabel")+":</p>"+"</div>"+'<div class="column">'+"<p>"+'<a href="https://www.zpovednicar.cz/" target="_blank">www.zpovednicar.cz</a>'+"</p>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+g.i18n("settingsHideDeleted")+":"+"</div>"+'<div class="column">'+'<input type="radio" name="hideDeleted" id="hideDeletedYes"'+(h.hideDeleted?" checked":"")+' value="1">&nbsp;'+'<label for="hideDeletedYes">'+g.i18n("yes")+"</label>&nbsp;"+'<input type="radio" name="hideDeleted" id="hideDeletedNo"'+(h.hideDeleted?"":" checked")+' value="0">&nbsp;'+'<label for="hideDeletedNo">'+g.i18n("no")+"</label>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+"<p>"+g.i18n("settingsHideUnregistered")+":</p>"+"</div>"+'<div class="column">'+"<p>"+'<input type="radio" name="hideUnregistered" id="hideUnregisteredYes"'+(h.hideUnregistered?" checked":"")+' value="1">&nbsp;'+'<label for="hideUnregisteredYes">'+g.i18n("yes")+"</label>&nbsp;"+'<input type="radio" name="hideUnregistered" id="hideUnregisteredNo"'+(h.hideUnregistered?"":" checked")+' value="0">&nbsp;'+'<label for="hideUnregisteredNo">'+g.i18n("no")+"</label>"+"</p>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+g.i18n("settingsYoutubeThumbnails")+":"+"</div>"+'<div class="column">'+'<select id="youtubeThumbnail">';h.youtubeThumbnails.forEach(function(e,t){r+='<option value="'+t+'"'+(t===h.youtubeThumbnail?" selected":"")+">"+e.label+"</option>"});r+="</select>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+"<p>"+g.i18n("settingsDomain")+":</p>"+"</div>"+'<div class="column">'+"<p>"+'<select id="enforceDomain">';h.domains.forEach(function(e,t){r+='<option value="'+t+'"'+(t===h.domain?" selected":"")+">"+e+"</option>"});r+="</select>"+"</p>"+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+g.i18n("settingsColor")+":"+"</div>"+'<div class="column">'+'<span class="colorFull"><input type="text" id="colorPicker" value="'+h.color+'"></span>'+"</div>"+"</div>"+'<div class="row">'+'<div class="column">'+"<p>"+g.i18n("settingsBackups")+":</p>"+"</div>"+'<div class="column">'+"<p>";if(o){r+='<button id="settingsBackup">'+g.i18n("settingsBackup")+"</button>"+"&nbsp;"+'<button id="settingsRestore">'+g.i18n("settingsRestore")+"</button>"}else{r+=g.i18n("fileSaverUnsupported")}r+="</p>"+"</div>"+"</div>"+"</div>";a.setContent(r);document.getElementById("enforceDomain").onchange=function(e){GM_setValue("sinner.enforceDomain",e.target.value)};document.getElementById("youtubeThumbnail").onchange=function(e){GM_setValue("sinner.youtubeThumbnail",parseInt(e.target.value))};document.querySelectorAll('input[name="useHighlighting"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.useHighlighting",Boolean(parseInt(e.target.value)))})});document.querySelectorAll('input[name="useHiding"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.useHiding",Boolean(parseInt(e.target.value)))})});document.querySelectorAll('input[name="hideDeleted"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.hideDeleted",Boolean(parseInt(e.target.value)))})});document.querySelectorAll('input[name="hideUnregistered"]').forEach(function(e){e.addEventListener("change",function(e){GM_setValue("sinner.hideUnregistered",Boolean(parseInt(e.target.value)))})});document.querySelector("div.tingle-modal-box__footer").appendChild(s);document.querySelector("div.tingle-modal").addEventListener("tabby",function(e){switch(e.target.hash.substr(1)){case"tabHighlight":g.Dom.formDisablement("sinnerDataForm");t.value=1;i.value=g.i18n("settingsHighlight");document.querySelector("div.tingle-modal-box__footer").style.display="block";break;case"tabHide":g.Dom.formDisablement("sinnerDataForm");t.value=0;i.value=g.i18n("settingsHide");document.querySelector("div.tingle-modal-box__footer").style.display="block";break;default:g.Dom.formDisablement("sinnerDataForm",true);g.Dom.formDisablement("sinnerDataForm",true);document.querySelector("div.tingle-modal-box__footer").style.display="none";break}});if(o){document.getElementById("settingsBackup").addEventListener("click",d.backup);document.getElementById("settingsRestore").addEventListener("click",d.restore)}Coloris({el:"#colorPicker",format:"hex",theme:"polaroid",themeMode:"dark",swatches:["#ff0000","#bf2626","#e76f51","#ffff00","#00ffff","#00ff00"],alpha:false});document.getElementById("colorPicker").addEventListener("change",function(e){GM_setValue("sinner.highlightColor",e.target.value)});a.tabs=new Tabby("[data-tabs]")}};class e{constructor(){this.initialize()}initialize(){o=g.Db.initialize();o.on("changes",this.observableListener);GM_addValueChangeListener("sinner.highlightColor",d.colorChangeListener);GM_addValueChangeListener("sinner.enforceDomain",d.domainChangeListener);GM_addValueChangeListener("sinner.youtubeThumbnail",d.youtubeThumbnailChangeListener);GM_addValueChangeListener("sinner.hideDeleted",d.hideDeletedChangeListener);GM_addValueChangeListener("sinner.hideUnregistered",d.hideUnregisteredChangeListener);GM_addValueChangeListener("sinner.useHighlighting",d.useHighlightingChangeListener);GM_addValueChangeListener("sinner.useHiding",d.useHidingChangeListener)}modal(e){e.preventDefault();if(typeof a==="undefined"){d.initializeModal();o.on("changes",d.observableListener)}a.open()}observableListener(e){e.forEach(function(e){if(e.table!=="idioms"){return}s.process()})}async hideDeleted(){}async showDeleted(){}async processUsers(){}async processWords(){}async process(){this.processUsers();this.processWords()}}class n extends e{initialize(){super.initialize();let e=document.querySelector("div#ixright").querySelector("div.boxaround").querySelector("div.boxchk"),t=document.createElement("br"),n=Object.assign(document.createElement("a"),{href:"#"}),i=document.createTextNode(g.i18n("menuLabel")),s=Object.assign(document.createElement("img"),{src:"grafika/flarr.gif",width:13,height:11,align:"top",border:0,alt:"Bod"});n.appendChild(s);n.appendChild(i);n.addEventListener("click",this.modal);e.appendChild(t);e.appendChild(n)}async processUsers(){let s=await g.Db.getIdioms("user",true,true),o=await g.Db.getIdioms("user",false,true);g.Css.removeClass(["highlightUser","hiddenUser"]);document.querySelectorAll("li.c4, li.c4u").forEach(function(e){let t=e.innerText.indexOf("("),n=t===-1?e.innerText:e.innerText.slice(0,t-1).trim(),i=g.String.compress(n,true,true,true);if(h.useHighlighting&&s.includes(i)){if(!e.classList.contains("highlightUser")){e.classList.add("highlightUser")}}else if(h.useHiding&&o.includes(i)){if(!e.parentElement.classList.contains("hiddenUser")){e.parentElement.classList.add("hiddenUser")}}})}async processWords(){let i=await g.Db.getIdioms("word",true),s=await g.Db.getIdioms("word",false);g.Css.removeClass("hiddenWord");document.querySelectorAll(".highlightWord").forEach(function(e){g.String.unwrap(e)});document.querySelectorAll("li.c3 a, li.c3l a").forEach(function(e){let t=false,n;if(h.useHiding&&(t=g.String.containsWord(e,s))!==false){e.parentElement.parentElement.classList.add("hiddenWord")}if(!t&&h.useHighlighting){if((n=g.String.wrapAll(e,i))!==false){e.innerHTML=n}}})}}class i extends e{async processUsers(){let c=await g.Db.getIdioms("user",true,true),u=await g.Db.getIdioms("user",false,true),e=document.querySelector("span.signunreg, span.signnick"),t=e.innerText.trim(),n=g.String.compress(t,true,true,true),i=e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;g.Css.removeClass(["highlightUser","hiddenUser"]);document.querySelectorAll(".userLinks").forEach(function(e){g.Dom.removeAllChildNodes(e);e.remove()});if(h.useHighlighting&&c.includes(n)){if(!i.classList.contains("highlightUser")){i.classList.add("highlightUser")}}document.querySelectorAll("td.signunreg, td.signnick").forEach(function(e){let t=e.innerText.trim(),n=g.String.compress(t,true,true,true),i=e.parentElement,s=i.querySelector("td.signinfo"),o=s.childElementCount!==0,r=i.parentElement.parentElement.parentElement.parentElement,l=r.previousElementSibling,a=l.previousElementSibling,d=[r,l,a];if(window.location.pathname.startsWith("/detail.php")&&h.hideUnregistered&&!o){d.forEach(function(e){if(!e.classList.contains("hiddenUser")){e.classList.add("hiddenUser")}})}if(h.useHighlighting&&c.includes(n)){if(!i.classList.contains("highlightUser")){i.classList.add("highlightUser")}}else if(h.useHiding&&u.includes(n)){d.forEach(function(e){if(!e.classList.contains("hiddenUser")){e.classList.add("hiddenUser")}})}else{let e=Object.assign(document.createElement("span"),{className:"userLinks"});s.prepend(e);g.Dom.embedUserLinks(e,t)}})}async processWords(){let l=await g.Db.getIdioms("word",true),a=await g.Db.getIdioms("word",false),e=document.querySelector("td.confheader"),t=document.querySelectorAll("td.conftext"),n=t[0],i=t[1].querySelectorAll("td.signinfo")[1],d;g.Css.removeClass("hiddenWord");document.querySelectorAll(".strikeWord").forEach(function(e){g.String.unwrap(e)});document.querySelectorAll(".highlightWord").forEach(function(e){g.String.unwrap(e)});if(h.useHiding){if((d=g.String.wrapAll(e,a,"strikeWord"))!==false){e.innerHTML=d}if((d=g.String.wrapAll(n,a,"strikeWord"))!==false){n.innerHTML=d}}if(h.useHighlighting){if((d=g.String.wrapAll(e,l))!==false){e.innerHTML=d}if((d=g.String.wrapAll(n,l))!==false){n.innerHTML=d}}if(g.Dom.isVip(i)){g.Dom.embedYoutube(n)}document.querySelectorAll("td.signunreg, td.signnick").forEach(function(e){let t=e.parentElement.parentElement.parentElement.parentElement.parentElement,n=t.previousElementSibling.previousElementSibling,i=t.previousElementSibling.firstElementChild,s=[t,n,i.parentElement],o=g.Dom.isVip(e.nextElementSibling),r=false;if(h.useHiding&&(r=g.String.containsWord(i,a))!==false){s.forEach(function(e){e.classList.add("hiddenWord")})}if(!r){if(h.useHighlighting){if((d=g.String.wrapAll(i,l))!==false){i.innerHTML=d}}if(o){g.Dom.embedYoutube(i)}}})}async hideDeleted(){document.querySelectorAll("td.infortext").forEach(function(e){let t=[e.parentElement,e.parentElement.previousElementSibling,e.parentElement.nextElementSibling],n=e.parentElement.previousElementSibling.previousElementSibling.firstElementChild.firstElementChild.innerHTML.trim();if(n.length===0){t.push(e.parentElement.previousElementSibling.previousElementSibling)}t.forEach(function(e){e.classList.add("hiddenDeleted")})})}async showDeleted(){document.querySelectorAll("tr.hiddenDeleted").forEach(function(e){e.classList.remove("hiddenDeleted")})}async process(){super.process();if(h.hideDeleted){this.hideDeleted()}}}class l extends e{async processUsers(){let r=await g.Db.getIdioms("user",true,true),l=await g.Db.getIdioms("user",false,true),e=document.querySelector("td.profheader"),t=e.innerText.trim(),n=g.String.compress(t,true,true,true),i=e.parentElement;g.Css.removeClass(["highlightUser","hiddenUser"]);document.querySelectorAll(".userLinks").forEach(function(e){g.Dom.removeAllChildNodes(e);e.remove()});if(h.useHighlighting&&r.includes(n)){if(!i.classList.contains("highlightUser")){i.classList.add("highlightUser")}}document.querySelectorAll("span.guestnote, span.guestnick").forEach(function(t){let e=t.innerText.indexOf("(")===-1,n=e?t.innerText.indexOf(":"):t.innerText.indexOf("(")-1,i=t.innerText.slice(0,n).trim(),s=g.String.compress(i,true,true,true),o=t.parentElement.parentElement;if(h.hideUnregistered&&!e){if(!o.classList.contains("hiddenUser")){o.classList.add("hiddenUser")}}if(h.useHighlighting&&r.includes(s)){if(!o.classList.contains("highlightUser")){o.classList.add("highlightUser")}}else if(h.useHiding&&l.includes(s)){if(!o.classList.contains("hiddenUser")){o.classList.add("hiddenUser")}}else{let e=Object.assign(document.createElement("span"),{className:"userLinks"});t.prepend(e);g.Dom.embedUserLinks(e,i)}})}async processWords(){let i=await g.Db.getIdioms("word",true),s=await g.Db.getIdioms("word",false);g.Css.removeClass("hiddenWord");document.querySelectorAll(".highlightWord").forEach(function(e){g.String.unwrap(e)});document.querySelectorAll("div.guesttext").forEach(function(e){let t=false,n;if(h.useHiding&&(t=g.String.containsWord(e,s))!==false){e.parentElement.parentElement.classList.add("hiddenWord")}if(!t&&h.useHighlighting){if((n=g.String.wrapAll(e,i))!==false){e.innerHTML=n}}})}}class c extends e{async processUsers(){let r=await g.Db.getIdioms("user",true,true),l=await g.Db.getIdioms("user",false,true);g.Css.removeClass(["highlightUser","hiddenUser"]);document.querySelectorAll(".userLinks").forEach(function(e){g.Dom.removeAllChildNodes(e);e.remove()});document.querySelectorAll("span.guestnote, span.guestnick").forEach(function(t){let e=t.innerText.indexOf("(")===-1,n=t.innerText.indexOf("(")===-1?t.innerText.indexOf(":"):t.innerText.indexOf("(")-1,i=t.innerText.slice(0,n).trim(),s=g.String.compress(i,true,true,true),o=t.parentElement.parentElement;if(h.hideUnregistered&&!e){if(!o.classList.contains("hiddenUser")){o.classList.add("hiddenUser")}}if(h.useHighlighting&&r.includes(s)){if(!o.classList.contains("highlightUser")){o.classList.add("highlightUser")}}else if(h.useHiding&&l.includes(s)){if(!o.classList.contains("hiddenUser")){o.classList.add("hiddenUser")}}else{let e=Object.assign(document.createElement("span"),{className:"userLinks"});t.prepend(e);g.Dom.embedUserLinks(e,i)}})}async processWords(){let i=await g.Db.getIdioms("word",true),s=await g.Db.getIdioms("word",false);document.querySelectorAll(".highlightWord").forEach(function(e){g.String.unwrap(e)});document.querySelectorAll(".hiddenWord").forEach(function(e){e.classList.remove("hiddenWord")});document.querySelectorAll("div.guesttext").forEach(function(e){let t=false,n;if(h.useHiding&&(t=g.String.containsWord(e,s))!==false){e.parentElement.parentElement.classList.add("hiddenWord")}if(!t&&h.useHighlighting){if((n=g.String.wrapAll(e,i))!==false){e.innerHTML=n}}})}}class u extends e{async processUsers(n){let i=await g.Db.getIdioms("user",true,true),s=await g.Db.getIdioms("user",false,true),o=0;n=n||0;g.Css.removeClass(["highlightStatsUser","hiddenUser"]);document.querySelectorAll("td.lstconf").forEach(function(e){if(o++<n){return}let t=g.String.compress(e.innerText,true,true,true);if(h.useHighlighting&&i.includes(t)){if(!e.classList.contains("highlightStatsUser")){e.classList.add("highlightStatsUser")}}else if(h.useHiding&&s.includes(t)){if(!e.parentElement.classList.contains("hiddenUser")){e.parentElement.classList.add("hiddenUser")}}})}async processWords(i){let s=await g.Db.getIdioms("word",true),o=await g.Db.getIdioms("word",false),r=0;i=i||0;document.querySelectorAll(".highlightWord").forEach(function(e){g.String.unwrap(e)});document.querySelectorAll(".hiddenWord").forEach(function(e){e.classList.remove("hiddenWord")});document.querySelectorAll("td.lstconf").forEach(function(e){let t=false,n;if(i>0&&++r>i){return}if(h.useHiding&&(t=g.String.containsWord(e,o))!==false){e.parentElement.classList.add("hiddenWord")}if(!t&&h.useHighlighting){if((n=g.String.wrapAll(e,s))!==false){e.innerHTML=n}}})}async process(){switch(window.location.search){case"?prehled=4":this.processUsers();break;case"?prehled=3":this.processUsers(40);this.processWords(40);break;case"?prehled=2":this.processUsers(20);this.processWords(20);break;case"?prehled=1":default:this.processWords();break}}}if(h.domain!=="."&&window.location.hostname!==h.domain){d.enforceDomain(h.domain);return}let m=window.location.pathname,p=m==="/"?"index":m.substring(1,m.indexOf(".php"));switch(p){case"index":s=new n;break;case"detail":case"zpovperl":s=new i;break;case"profil":s=new l;break;case"kniha":s=new c;break;case"stat":s=new u;break;default:console.error("ZPOVEDNICAR unknown page "+p);return}g.Css.initializeStylesheet();GM_registerMenuCommand(g.i18n("settingsLabel"),s.modal);s.process()});
